After making the stupid thing work, I must now make it work well. This branch is not guaranteed to work.
